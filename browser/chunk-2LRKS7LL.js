import{a as u}from"./chunk-LENLY4OQ.js";import{a as i,c as A}from"./chunk-3OXCQRJB.js";import{c as $}from"./chunk-FO6KVJXE.js";import{r as j}from"./chunk-3RUIS27I.js";import{b as y,h as H,j as R,k as M,m as l}from"./chunk-NXN4P4DR.js";import{B as T,I as h,J as m,O as b,W as k,Z as c,ca as s,da as a,fb as v,v as S,w as p,z as d}from"./chunk-QSF35MWG.js";var f=class o{constructor(e,r,t){this.router=e;this.activatedRoute=r;this.titleService=t;this.state.$menuTree.set(i.getItem("menus")),this.setTitlePage()}state={$menuTree:v([]),$pageTitle:v("")};$menuTree=this.state.$menuTree.asReadonly();setTitlePage(){this.router.events.pipe(h(e=>e instanceof R),d(()=>this.activatedRoute),d(e=>{for(;e.firstChild;)e=e.firstChild;return e}),h(e=>e.outlet==="primary"),T(e=>e.data)).subscribe(e=>{e.pageTitle?this.titleService.setTitle(`Appraisal > ${e.pageTitle} `):this.titleService.setTitle("Appraisal")})}findInTreeBFS(e){let r=this.$menuTree();for(;r.length>0;){let t=r.shift();if(console.log(t),t&&t.routerLink===e)return t;if(t&&t.items)for(let n of t?.items||[])r.push(n)}return null}resetState(){this.state.$menuTree.set([]),this.state.$pageTitle.set(null)}static \u0275fac=function(r){return new(r||o)(s(l),s(M),s(H))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var E="tokenId",F=j.APPRAISAL_API_URL+"/auth",g=class o{constructor(e,r,t){this.userStore=e;this.menuTreeStore=r;this.http=t}isAuthenticated(){return!!this.tokenId}login(e){return this.loginService(e).pipe(k(r=>{r.status&&r.object?.jwtToken&&(this.setTokenId(r.object?.jwtToken),i.setItem("user",r.object),i.setItem("menus",this.featureToMenuItem(r.object?.role?.feature)))}))}featureToMenuItem(e){let r=[];for(let t of e){let n={};n.label=t.feature.name,n.icon=t.feature.icon,t.children&&(n.items=this.featureToMenuItem(t.children)),t.feature.accessLink&&(n.routerLink=t.feature.accessLink),r.push(n)}return r}loginService(e){return this.http.post(F+"/login",e)}forgotPassword(){}logout(){return this.logoutService().pipe(b(()=>{i.clear()}))}logoutService(){return S({})}setTokenId(e){i.setItem(E,e)}get tokenId(){return i.getItem(E)}static \u0275fac=function(r){return new(r||o)(s(A),s(f),s(y))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var te={"768px":{width:"calc(100% - 6px)",right:"3px",left:"3px"},"600px":{width:"calc(100% - 4px)",right:"2px",left:"2px"}};var ie=(o,e)=>{if(i.getItem("tokenId")){let r=i.getItem("tokenId")||"";o=o.clone({headers:o.headers.set("Authorization",`Bearer ${r}`)})}return o=o.clone({headers:o.headers.set("Accept","*/*")}),e(o)};var ge=(o,e)=>{let r=a(g),t=a(u),n=a($),x=a(l);return e(o).pipe(m(I=>([0,401].includes(I.status)&&(t.add({severity:"error",summary:"Error",detail:"Session Token telah habis, silahkan login kembali!"}),n.dialogComponentRefMap.forEach(L=>{L.destroy()}),r.logout(),x.navigate(["/login"])),p(I))))};var Te=(o,e)=>{let r=a(u);return e(o).pipe(m(t=>(console.log(t),[400,403,405,500,409].includes(t.status)&&r.add({severity:"error",summary:"Error",detail:t.error&&(t.error.message||t.error.detail)?t.error.message||t.error.detail:t.message}),p(()=>t))))};export{f as a,g as b,ie as c,ge as d,Te as e,te as f};
