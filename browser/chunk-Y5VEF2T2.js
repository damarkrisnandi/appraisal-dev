import{a as oe}from"./chunk-LENLY4OQ.js";import{I as L,h as ee,m as te,n as se,s as ne}from"./chunk-7RAOKYUK.js";import"./chunk-R7WHARF6.js";import{p as v}from"./chunk-W6BPNARK.js";import"./chunk-4YRY4IP2.js";import"./chunk-EMVC5IJA.js";import"./chunk-AIVTLASU.js";import"./chunk-AUJU2NY4.js";import{a as F}from"./chunk-OQKDZ6KP.js";import{r as ae}from"./chunk-3RUIS27I.js";import{b as W}from"./chunk-NXN4P4DR.js";import{a as ie}from"./chunk-QASMVVIP.js";import{a as Z}from"./chunk-BUA7TEAX.js";import{ma as X}from"./chunk-22342MAH.js";import{$b as x,Ab as O,Bb as l,Cb as o,Db as g,Hb as D,Ib as S,Jb as m,Qc as J,Sb as E,Tb as u,Ua as B,Vb as h,Wc as Q,Ya as r,Z as y,_b as U,a as R,ac as K,b as T,ca as p,da as C,fb as a,ha as b,kc as Y,mc as q,nc as _,ob as $,qb as z,ra as P,rb as c,sa as I,vb as f,wb as N,xb as V,zb as H,zc as A}from"./chunk-QSF35MWG.js";var M=ae.APPRAISAL_API_URL+"/assessment",G=class s{constructor(t){this.http=t}generateAllStaffAssessment(t){return this.http.post(M+"/generateAllStaffAssessment",{tahun:t})}getNextCountAssessment(t){return this.http.post(M+"/getNextCountAssessment",{tahun:t})}monitorLogAssessment({tahun:t,status:e,pagingInfo:n}){return this.http.post(M+"/monitorLogAssessment",{tahun:t,status:e,pagingInfo:n})}static \u0275fac=function(e){return new(e||s)(p(W))};static \u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})};var d=class s{constructor(t,e,n,i){this.generateSelfAssessmentService=t;this.messageService=e;this.confirmationService=n;this.spinnerService=i;this.init()}state={$mode:a("idle"),$dataList:a([]),$dataLoading:a(!1),$pagingInfo:a(new F),$totalRowCount:a(1),$selectedData:a(null),$selectedVerified:a(!0),$loading:a(!1),$disabledTable:a(!1),$optionsCategory:a([]),$selectedCategory:a(""),$searchText:a(""),$searchBtnClickEvent:a(!1)};$dataList=this.state.$dataList.asReadonly();$dataLoading=this.state.$dataLoading.asReadonly();$selectedData=this.state.$selectedData.asReadonly();$cols=a([{field:"user",header:"User",class_td:"!text-center"},{field:"tahun",header:"Tahun",class_td:"!text-center"},{field:"startTimeProcessing",header:"Start Time Processing",class_td:"!text-center",type:"date"},{field:"endTimeProcessing",header:"End Time Processing",class_td:"!text-center",type:"date"},{field:"startBatchProcessing",header:"Start Batch Processing",class_td:"!text-center",type:"date"},{field:"endBatchProcessing",header:"End Batch Processing",class_td:"!text-center",type:"date"},{field:"totalAssessment",header:"Total Assessments",class_td:"!text-center"},{field:"status",header:"Status",class_td:"!text-center"},{field:"successfullAssessment",header:"Successfull Assessment",class_td:"!text-center"}]).asReadonly();$pagingInfo=this.state.$pagingInfo.asReadonly();$totalRowCount=this.state.$totalRowCount.asReadonly();$optionsCategory=this.state.$optionsCategory.asReadonly();$selectedCategory=this.state.$selectedCategory.asReadonly();$searchText=this.state.$searchText.asReadonly();$filter=A(()=>{let t=null;if(this.$selectedCategory()){t={};let e=this.$selectedCategory()??"",n;["tahun","status"].includes(e)?n=this.$searchText()??"":n=parseInt(this.$searchText()),t[e]=n}return t});$disabledTable=A(()=>this.state.$mode()=="generate");$mode=this.state.$mode.asReadonly();$buttonLabel=A(()=>this.$mode()=="idle"?"Generate Assessments":"Generating Assessments...");$buttonDisabled=A(()=>this.$mode()=="generate");init(){this.setSpinner()}setSpinner(){ie(this.state.$mode).subscribe(t=>t=="generate"?this.spinnerService.show():this.spinnerService.hide())}generateAssessments(){this.generateSelfAssessmentService.getNextCountAssessment(new Date().getFullYear().toString()).subscribe(t=>{t.status&&this.confirmationService.confirm({header:"Konfirmasi",message:`Apakah Anda yakin ingin Men-<i>generate</i> ${t.object?.jumlah} assessments ?`,accept:()=>{this.confirmGenerateAssessments()},reject:()=>{}})})}confirmGenerateAssessments(){this.state.$mode.set("generate"),this.generateSelfAssessmentService.generateAllStaffAssessment(new Date().getFullYear().toString()).subscribe(t=>{this.messageService.add({severity:"success",summary:"Success",detail:"Self Assessment telah tergenerate"}),this.state.$mode.set("idle")})}populateList(){this.state.$dataLoading.set(!0);let t=T(R({},this.$filter()),{pagingInfo:this.state.$pagingInfo()});this.generateSelfAssessmentService.monitorLogAssessment(t).subscribe(e=>{e.status&&(this.state.$pagingInfo.set(e.object.pagingInfo||new F),this.state.$dataList.set(e.object.dataList||[]),this.state.$totalRowCount.set(e.object.totalRowCount||0)),this.state.$dataLoading.set(!1)})}onLazyLoad(t){this.state.$pagingInfo.set(T(R({},this.$pagingInfo()),{currentPage:Math.floor(t.first/t.rows)+1,pageSize:t.rows})),this.populateList()}statusStyle(t,e){let n=["successfullAssessment"],i="";return t.status.toLowerCase()=="done"&&(t.successfullAssessment!==t.totalAssessment?i=" !text-red-600 !font-semibold":i=" !text-green-600 !font-semibold"),n.includes(e)||(i=""),i}static \u0275fac=function(e){return new(e||s)(p(G),p(oe),p(X),p(Z))};static \u0275prov=y({token:s,factory:s.\u0275fac})};var de=()=>[5,10,20];function fe(s,t){if(s&1&&(l(0,"th",10),u(1),o()),s&2){let e=t.$implicit;r(),h(" ",e.header," ")}}function ge(s,t){if(s&1&&(l(0,"tr"),$(1,fe,2,1,"th",9),o()),s&2){let e=t.$implicit;r(),c("ngForOf",e)}}function ue(s,t){if(s&1&&(l(0,"td"),g(1,"div",13),o()),s&2){let e=m().$implicit,n=m().$implicit;f(e.class_td),r(),c("outerHTML",e.template(n[e.field]),B)}}function _e(s,t){if(s&1&&g(0,"td"),s&2){let e=m().$implicit;f(e.class_td)}}function Se(s,t){if(s&1&&(l(0,"td"),u(1),Y(2,"date"),o()),s&2){let e=m().$implicit,n=m().$implicit;f(e.class_td),r(),h(" ",q(2,3,n[e.field],"dd/MM/yyyy hh:mm a")," ")}}function he(s,t){if(s&1&&(l(0,"td"),u(1),o()),s&2){let e=m().$implicit,n=m().rowIndex;f(e.class_td),r(),h(" ",n+1," ")}}function Ae(s,t){if(s&1&&(l(0,"td"),u(1),o()),s&2){let e=m().$implicit,n=m().$implicit,i=m();f(e.class_td+i.generateSelfAssessmentStore.statusStyle(n,e.field)),r(),h(" ",n[e.field]," ")}}function ye(s,t){if(s&1&&$(0,ue,2,3,"td",12)(1,_e,1,2,"td",12)(2,Se,3,6,"td",12)(3,he,2,3,"td",12)(4,Ae,2,3,"td",12),s&2){let e,n=t.$implicit;N((e=n.type)==="custom"?0:e==="action"?1:e==="date"?2:e==="no"?3:4)}}function Ce(s,t){if(s&1&&(l(0,"tr",11),H(1,ye,5,1,null,null,V),o()),s&2){let e=t.$implicit,n=t.columns;c("pSelectableRow",e),r(),O(n)}}function be(s,t){if(s&1&&(l(0,"tr")(1,"td",14),u(2,"Data Kosong"),o()()),s&2){let e=m();r(),z("colspan",e.generateSelfAssessmentStore.$cols().length)}}function $e(s,t){}function xe(s,t){if(s&1){let e=D();l(0,"p-button",15),S("click",function(){P(e);let i=m();return I(i.generateSelfAssessmentStore.populateList())}),o()}}var w=class s{generateSelfAssessmentStore=C(d);static \u0275fac=function(e){return new(e||s)};static \u0275cmp=b({type:s,selectors:[["app-generated-assessment-list"]],standalone:!0,features:[x],decls:14,vars:12,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],["paginatorleft",""],["paginatorright",""],[1,"card"],["showGridlines","",3,"onLazyLoad","columns","value","loading","paginator","rows","rowsPerPageOptions","paginatorDropdownAppendTo","lazy","totalRecords"],[3,"blocked","target"],["class","!text-center",4,"ngFor","ngForOf"],[1,"!text-center"],[3,"pSelectableRow"],[3,"class"],[3,"outerHTML"],[1,"!text-center","w-full"],["icon","pi pi-refresh",3,"click"]],template:function(e,n){if(e&1){let i=D();l(0,"div",6)(1,"p-table",7,0),S("onLazyLoad",function(le){return P(i),I(n.generateSelfAssessmentStore.onLazyLoad(le))}),$(3,ge,2,1,"ng-template",null,1,_)(5,Ce,3,1,"ng-template",null,2,_)(7,be,3,1,"ng-template",null,3,_)(9,$e,0,0,"ng-template",null,4,_)(11,xe,1,0,"ng-template",null,5,_),o()(),g(13,"p-blockui",8)}if(e&2){let i=E(2),k=E(6);r(),c("columns",n.generateSelfAssessmentStore.$cols())("value",n.generateSelfAssessmentStore.$dataList())("loading",n.generateSelfAssessmentStore.$dataLoading())("paginator",!0)("rows",5)("rowsPerPageOptions",K(11,de))("paginatorDropdownAppendTo",k)("lazy",!0)("totalRecords",n.generateSelfAssessmentStore.$totalRowCount()),r(12),c("blocked",n.generateSelfAssessmentStore.$disabledTable())("target",i)}},dependencies:[L,v,te,se,J,ne,Q]})};var re=class s{generateSelfAssessmentStore=C(d);static \u0275fac=function(e){return new(e||s)};static \u0275cmp=b({type:s,selectors:[["app-generate-self-assessment"]],standalone:!0,features:[U([d]),x],decls:4,vars:2,consts:[["header","Generate Self Assessment",1,"h-40"],[1,"flex","flex-col","gap-2"],["icon","pi pi-cog","severity","contrast",3,"click","label","disabled"]],template:function(e,n){e&1&&(l(0,"p-panel",0)(1,"div",1)(2,"p-button",2),S("click",function(){return n.generateSelfAssessmentStore.generateAssessments()}),o(),g(3,"app-generated-assessment-list"),o()()),e&2&&(r(2),c("label",n.generateSelfAssessmentStore.$buttonLabel())("disabled",n.generateSelfAssessmentStore.$buttonDisabled()))},dependencies:[L,ee,v,w]})};export{re as GenerateSelfAssessmentComponent};
